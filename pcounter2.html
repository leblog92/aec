<!DOCTYPE HTML>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <title>PCOUNTER Search</title>
    <link rel="icon" type="image/png" href="favicon2.png" />
    <style>
        html, body {
            height: 100%;
            margin: 0;
        }

        body {
            font-family: monospace;
            text-align: center;
            background: linear-gradient(orange, gold);
            background-attachment: fixed;
        }

        body, input[type="text"] {
            font-size: 1em;
        }

        body::-webkit-scrollbar {
            display: none;
        }

        input[type="text"] {
            padding: 10px;
            border-radius: 10px;
        }

        td {
            background: gold;
            border-radius: 10px;
            padding: 10px;
            box-shadow: 10px 20px 20px rgba(0, 0, 0, 0.2);
            cursor: pointer;
        }

        td {
            vertical-align: middle;
        }

        a {
            color: black;
            text-decoration: none;
        }

        .crossed {
            text-decoration: line-through;
        }

        .center {
            margin-left: auto;
            margin-right: auto;
        }

        #logo {
            margin: 20px 0;
        }

        #fill {
            color: rgba(255, 255, 255, 0.5);
            position: fixed;
            top: 0;
            right: 0;
            width: 10%;
            font-size: 1em;
        }
    </style>
</head>
<body>
    <br>
    <div id="logo">
        <h1><b>PCOUNTER SEARCH</b></1>
    </div>
    <input autocapitalize="off" type="text" id="name_input"><br><br>
    <div id="fill"></div>
    <div id="progress"></div>
    <table class="center">
        <tbody id="tab_results"></tbody>
    </table>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.1.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.2/firebase-firestore.js"></script>
    
    <script>
        // Your Firebase configuration object
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT_ID.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        var logo = document.getElementById("logo");
        var name_input = document.getElementById("name_input");
        var tab_results = document.getElementById("tab_results");
        var resultArr = [];
        var resultImg = [];
        // Load crossed entries from Firestore
        async function loadCrossedEntries() {
            const snapshot = await db.collection('crossedEntries').get();
            snapshot.forEach(doc => {
                const data = doc.data();
                const crossedText = data.text;
                const rows = tab_results.children;
                for (var i = 0; i < rows.length; i++) {
                    if (crossedText === rows[i].children[0].innerText.trim()) {
                        rows[i].children[0].classList.add("crossed");
                    }
                }
            });
        }

        // Save crossed entry to Firestore
        async function saveCrossedEntry(text) {
            await db.collection('crossedEntries').add({ text: text });
        }

        function show() {
            tab_results.innerHTML = "";
            resultArr = [];
            name_input.value = name_input.value.toLowerCase();
            name_input.value = name_input.value.replace(/[^a-zA-Z0-9 ]/g, ""); // Clean input
            var str = name_input.value;

            if (str.length > 2) {
                for (var i = 0; i < arr1.length; i++) {
                    if (arr1[i].toLowerCase().indexOf(str) !== -1) {
                        resultArr.push(arr2[i]);
                        resultImg.push(arr3[i]);
                    }
                }
                if (resultArr.length == 0) {
                    tab_results.innerHTML = "<tr><td>Aucun rÃ©sultat ...<br><span style='font-size:1em'>ðŸ™€</span><br>Essaie encore !<br><span style='font-size:1em'>ðŸ˜»</span></td></tr>";
                } else {
                    for (var k = 0; k < resultArr.length; k++) {
                        var row = document.createElement("tr");
                        var cell = document.createElement("td");
                        cell.innerHTML = resultArr[k] + " <span style='float:right;'>" + resultImg[k] + " â‚¬</span>";
                        cell.onclick = async function () {
                            const cellText = this.innerText.trim();
                            this.classList.toggle("crossed");
                            if (this.classList.contains("crossed")) {
                                await saveCrossedEntry(cellText);
                            } else {
                                await db.collection('crossedEntries').where("text", "==", cellText).get().then(snapshot => {
                                    snapshot.forEach(doc => {
                                        doc.ref.delete();
                                    });
                                });
                            }
                        };
                        row.appendChild(cell);
                        tab_results.appendChild(row);
                    }
                }
            }
        }

        name_input.onclick = function out() {
            logo.style.display = "none";
            name_input.value = "";
            tab_results.innerHTML = "<tr><td>Recherche parmi " + arr1.length + " noms d'adhÃ©rents</td></tr>";
        }

        function init() {
            name_input.addEventListener("keyup", show);
            loadCrossedEntries();
        }

        init();
    </script>
</body>
</html>